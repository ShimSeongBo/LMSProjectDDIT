<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.LectureMapper">

	<sql id="where">
		<!-- 강의 검색 -->
		and  (  L.LECA_CD     LIKE '%' || #{keyword} || '%'
	    or      E.EMP_NM      LIKE '%' || #{keyword} || '%'
	  	or      LA.LECA_NM    LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_CRD   LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_CAP   LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_CATE  LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_YR    LIKE '%' || #{keyword} || '%')
	</sql>
	
	<sql id="where2">
		<!-- 강의 검색 -->
	  	and  (  LA.LECA_NM    LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_SEM   LIKE '%' || #{keyword} || '%'
	 	or      LA.LECA_YR    LIKE '%' || #{keyword} || '%')
	</sql>
	
	<!-- lecture resultMap======================================================================== -->
	<resultMap type="lecture" id="lectureMap">
		<result property="lecaCd" column="LECA_CD" />
		<result property="subCd" column="SUB_CD" />
		<result property="lecYn" column="LEC_YN" />
		<result property="lecHcnt" column="LEC_HCNT" />
		<result property="lecaYn" column="LECA_YN" />
		<result property="depCd" column="DEP_CD" />
		<collection property="lecApply" resultMap="lecApplyMap"></collection>
		<collection property="employee" resultMap="employeeMap"></collection>
		<collection property="department" resultMap="departmentMap"></collection>
    <collection property="taskList" resultMap="taskMap"></collection>
	</resultMap>
	
	<!-- employee resultMap======================================================================== -->
	<resultMap type="employee" id="employeeMap">
		<result property="empNo"  column="EMP_NO" />
		<result property="empNm" column="EMP_NM" />
		<result property="empNme" column="EMP_NME" />
		<result property="empTel" column="EMP_TEL" />
		<result property="empTel2"  column="EMP_TEL2" />
		<result property="empZip" column="EMP_ZIP" />
		<result property="empAddr1"  column="EMP_ADDR1" />
		<result property="empAddr2"  column="EMP_ADDR2" />
		<result property="empReg" column="EMP_REG" />
		<result property="empBankCd"  column="EMP_BANK_CD" />
		<result property="empDepo"  column="EMP_DEPO" />
		<result property="empAct" column="EMP_ACT" />
		<result property="empPic" column="EMP_PIC" />
		<result property="empJoin"  column="EMP_JOIN" />
		<result property="empRet" column="EMP_RET" />
	</resultMap>
	
	<!-- lecApply resultMap======================================================================== -->
	<resultMap type="lecApply" id="lecApplyMap">
		<result property="lecaCd"  column="LECA_CD" />
		<result property="lecaYr"  column="LECA_YR" />
		<result property="lecaSem" column="LECA_SEM" />
		<result property="lecaNm"  column="LECA_NM" />
		<result property="lecaCon" column="LECA_CON" />
		<result property="lecaTrg" column="LECA_TRG" />
		<result property="lecaCrd" column="LECA_CRD" />
		<result property="lecaPer" column="LECA_PER" />
		<result property="lecaCap" column="LECA_CAP" />
		<result property="lecaTm"  column="LECA_TM" />
		<result property="lecaWk"  column="LECA_WK" />
		<result property="lecaHall" column="LECA_HALL" />
		<result property="lecaUnit" column="LECA_UNIT" />
		<result property="lecaBook" column="LECA_BOOK" />
		<result property="lecaNote" column="LECA_NOTE" />
		<result property="lecaDt" column="LECA_DT" />
		<result property="lecaGrade" column="LECA_GRADE" />
		<result property="lecaImsiYn" column="LECA_IMSI_YN" />
		<result property="lecaCate" column="LECA_CATE" />
		<result property="lecaMp" column="LECA_MP" />
		<result property="lecaFp" column="LECA_FP" />
		<result property="lecaTp" column="LECA_TP" />
		<result property="lecaAp" column="LECA_AP" />
	</resultMap>
	
	<!-- DEPARTMENT resultMap======================================================================== -->
	<resultMap type="department" id="departmentMap">
		<result property="depCd"  column="DEP_CD" />
		<result property="colCd"  column="COL_CD" />
		<result property="proNo"  column="PRO_NO" />
		<result property="depNm"  column="DEP_NM" />
		<result property="depDes" column="DEP_DES" />
		<result property="depCap" column="DEP_CAP" />
		<result property="depTel" column="DEP_TEL" />
		<result property="empNo"  column="EMP_NO"/>
	</resultMap>
  
  <!-- DEPARTMENT resultMap======================================================================== -->                                                                                                                                              
	<resultMap type="task" id="taskMap">                                                                                                                                                                                                               
		<result property="taskCd" column="TASK_CD"/>                                                                                                                                                                                                   
		<result property="lecaCd" column="LECA_CD"/>                                                                                                                                                                                                   
		<result property="taskNm" column="TASK_NM"/>                                                                                                                                                                                                   
		<result property="taskCon" column="TASK_CON"/>                                                                                                                                                                                                 
		<result property="taskSdt" column="TASK_SDT"/>                                                                                                                                                                                                 
		<result property="taskEdt" column="TASK_EDT"/>                                                                                                                                                                                                 
		<result property="atchFileId" column="ATCH_FILE_ID" />                                                                                                                                                                                         
	</resultMap>   

	<!-- 이번 학기 전체 강의 목록======================================================================== -->
	<select id="lectureSearch" parameterType="string" resultMap="lectureMap">
		SELECT 
		       L.LECA_CD 
		     , E.EMP_NM 
		     , LA.LECA_NM 
		     , LA.LECA_CRD 
		     , D.DEP_NM
		     , LA.LECA_CAP 
		     , LA.LECA_CATE 
		     , LA.LECA_YR
		     , DECODE(SUBSTR(LA.LECA_SEM,4,2), '9', 2, '10' , 2, '11' , 2, '12' , 2, '03', 1, '04' , 1, '05' , 1 , '06' , 1, '방학') "LECA_SEM"
		FROM PROFESSOR P, EMPLOYEE E, SUBJECT S, LECTURE L, LEC_APPLY LA, DEPARTMENT D
		WHERE E.EMP_NO = P.PRO_NO AND P.PRO_NO = S.PRO_NO 
		AND S.SUB_CD = L.SUB_CD AND L.LECA_CD = LA.LECA_CD AND L.DEP_CD = D.DEP_CD
		<if test="keyword != null and keyword !=''">
				<include refid="where"></include>
		</if>
	</select>
	
	<!-- 담당 강의 조회 (교수가 담당한 강의 검색)======================================================================== -->
	<select id="professorLecture" resultMap="lectureMap" parameterType="string">
		SELECT L.LECA_CD
		     , LA.LECA_NM 
		     , LA.LECA_YR
		     , DECODE(SUBSTR(LA.LECA_SEM,4,2), '9', 2, '10' , 2, '11' , 2, '12' , 2, '03', 1, '04' , 1, '05' , 1 , '06' , 1, '방학') "LECA_SEM"
		FROM PROFESSOR P, EMPLOYEE E, SUBJECT S, LECTURE L, LEC_APPLY LA, DEPARTMENT D
		WHERE E.EMP_NO = P.PRO_NO AND P.PRO_NO = S.PRO_NO 
		AND S.SUB_CD = L.SUB_CD AND L.LECA_CD = LA.LECA_CD AND L.DEP_CD = D.DEP_CD
		AND S.PRO_NO = #{professorId}
<!-- 		<if test="keyword != null and keyword !=''"> -->
<!-- 				<include refid="where2"></include> -->
<!-- 		</if> -->
	</select>
  
  <select id="searchTask" resultMap="lectureMap" parameterType="String">                                                                                                                                                                                                    
	select LA.LECA_NM,
	       LA.LECA_CD,
	       T.TASK_CD,
	       T.TASK_NM,
	       T.TASK_CON,
	       T.TASK_SDT,
	       T.TASK_EDT
	from LECTURE L, TASK T, LEC_APPLY LA
	WHERE L.LECA_CD = T.LECA_CD
	AND LA.LECA_CD = L.LECA_CD
	and LA.LECA_CD = #{lecaCd}                                                                                                                                                                                                                      
	</select>       
	
	<select id="studentNotYetApplyLectureList" parameterType="studentLecture" resultMap="lectureMap">
	
	</select>
	
	<select id="studentCompleteApplyLectureList" parameterType="studentLecture" resultMap="lectureMap">
		SELECT 
		       L.LECA_CD 
		     , E.EMP_NM 
		     , LA.LECA_NM 
		     , LA.LECA_CRD 
		     , LA.LECA_TRG
		     , L.LEC_HCNT
		     , D.DEP_NM
		     , LA.LECA_CAP 
		     , LA.LECA_CATE 
		     , LA.LECA_YR
		     , DECODE(SUBSTR(LA.LECA_SEM,4,2), '9', 2, '10' , 2, '11' , 2, '12' , 2, '03', 1, '04' , 1, '05' , 1 , '06' , 1, '방학') "LECA_SEM"
		     , SL.STU_NO
		FROM PROFESSOR P INNER JOIN EMPLOYEE E ON(E.EMP_NO = P.PRO_NO)
		                INNER JOIN SUBJECT S ON(P.PRO_NO = S.PRO_NO)
		                INNER JOIN LECTURE L ON(S.SUB_CD = L.SUB_CD)
		                INNER JOIN LEC_APPLY LA ON(L.LECA_CD = LA.LECA_CD)
		                INNER JOIN DEPARTMENT D ON(L.DEP_CD = D.DEP_CD)
		                LEFT OUTER JOIN STU_LEC SL ON(SL.LECA_CD = L.LECA_CD)
		WHERE SL.STU_NO = 21811001
	</select>
	
</mapper>