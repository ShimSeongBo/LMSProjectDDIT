<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : xml파일은 여러개일 수 있음. 
이를 구별하기 위한 식별 용도로 사용 -->
<mapper namespace="kr.or.ddit.mapper.KeyIndicatorsMapper">

	<select id="recruitmentRateList" parameterType="keyIndicators" resultType="keyIndicators">  
		WITH T AS (
		    SELECT
		        NVL(COUNT(S.STU_NO),0) RECRUITMENT_RATE
		        ,C.COL_NM
		        ,C.COL_CD 
		    FROM
		        COLLEGE C
		        ,DEPARTMENT D
		        ,STUDENT S
		    WHERE
		        D.DEP_CD = S.DEP_CD (+)
		        AND   C.COL_CD = D.COL_CD (+)
		        <if test="yr != 0">
		        AND   SUBSTR(S.STU_NO,1,4) = #{yr}
		        </if>
		    GROUP BY
		        C.COL_NM
		        ,C.COL_CD
		) SELECT
		    NVL(T.RECRUITMENT_RATE,0) RECRUITMENT_RATE
		    ,C.COL_NM
		    ,C.COL_CD
		    ,(
		        SELECT
		            NVL(SUM(DE.DEP_CAP),0)
		        FROM
		            DEPARTMENT DE
		        WHERE
		            DE.COL_CD = C.COL_CD
		    ) CAPACITY
		  FROM
		    T
		    ,COLLEGE C
		    ,DEPARTMENT D
		  WHERE
		    C.COL_CD = D.COL_CD (+)
		    AND   T.COL_CD (+) = C.COL_CD
	</select>

</mapper>

