<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.ManageMapper">
	
	<select id="studentList" resultType="student"> 
		SELECT 	S.STU_NO
				, S.DEP_CD
				, S.STU_YR
				, S.STU_SEM
				, S.STU_NM
				, S.STU_NME
				, S.STU_TEL
				, S.STU_ZIP
				, S.STU_ADDR1
				, S.STU_ADDR2
				, S.STU_REG
				, S.STU_BANK_CD
				, S.STU_DEPO
				, S.STU_ACT
				, S.STU_PIC
				, S.STU_BIR
				, S.PRO_NO
				, D.DEP_CD
				, D.DEP_NM
				, C.COL_CD
				, C.COL_NM
				, E.EMP_NM
		FROM STUDENT S, DEPARTMENT D, COLLEGE C, EMPLOYEE E
		WHERE S.DEP_CD = D.DEP_CD
		AND D.COL_CD = C.COL_CD
		AND S.PRO_NO = E.EMP_NO
	</select>
	
	<select id="detailStu" parameterType="map" resultType="student">
		SELECT 	S.STU_NO
				, S.DEP_CD
				, S.STU_YR
				, S.STU_SEM
				, S.STU_NM
				, S.STU_NME
				, S.STU_TEL
				, S.STU_ZIP
				, S.STU_ADDR1
				, S.STU_ADDR2
				, S.STU_REG
				, S.STU_BANK_CD
				, S.STU_DEPO
				, S.STU_ACT
				, S.STU_PIC
				, S.STU_BIR
				, S.PRO_NO
				, D.DEP_CD
				, D.DEP_NM
				, C.COL_CD
				, C.COL_NM
				, E.EMP_NM
		FROM STUDENT S, DEPARTMENT D, COLLEGE C, EMPLOYEE E
		WHERE S.DEP_CD = D.DEP_CD
		AND D.COL_CD = C.COL_CD
		AND S.PRO_NO = E.EMP_NO
		AND S.STU_NO = #{detailStu} 
	</select>
	
	<delete id="deleteStu" parameterType="map" >
		DELETE FROM STUDENT
		WHERE STU_NO = #{stuNo}
	</delete>
	
	<update id="updateStu" parameterType="student">  
		UPDATE STUDENT S
		SET      S.STU_YR = #{stuYr}
		        , S.STU_SEM= #{stuSem}
		        , S.STU_NM= #{stuNm}
		        , S.STU_NME= #{stuNme}
		        , S.STU_TEL= #{stuTel}
		        , S.STU_ZIP= #{stuZip}
		        , S.STU_ADDR1= #{stuAddr1}
		        , S.STU_ADDR2= #{stuAddr2}
		        , S.STU_BANK_CD= #{stuBankCd}
		        , S.STU_DEPO= #{stuDepo}
		        , S.STU_ACT= #{stuAct}
		        <if test="stuPic != null">
		        , S.STU_PIC= #{stuPic}
		        </if>
		        , S.STU_BIR= #{stuBir}
		        , S.DEP_CD = (SELECT DEP_CD FROM DEPARTMENT WHERE DEP_CD=#{depCd})
		WHERE S.STU_NO = #{stuNo}
	</update>
	
	<select id="recordManage" resultType="student"> 
		SELECT  S.STU_NO
		        ,S.STU_NM
		        ,D.DEP_NM
		        ,R.REC_YR
		        ,R.REC_SEM
		        ,(SELECT  C.COMD_NM FROM COMMON_DETAIL C WHERE C.COMD_CD = R.RGB_CD) AS RGB_CD
		        ,R.REC_PER
		        ,R.REC_RSN
		        ,R.REC_DT
		        ,(SELECT C.COMD_NM FROM COMMON_DETAIL C WHERE C.COMD_CD = R.REC_YN) AS REC_YN
		FROM STUDENT S, DEPARTMENT D, RECORD R
		WHERE S.DEP_CD = D.DEP_CD
		AND S.STU_NO = R.STU_NO
	</select>
	
	<select id="recordManagePost" parameterType="map" resultType="student" > 
		SELECT  S.STU_NO
		        ,S.STU_NM
		        ,S.STU_TEL
		        ,D.DEP_NM
		        ,R.REC_YR
		        ,R.REC_SEM
		        ,(SELECT  C.COMD_NM FROM COMMON_DETAIL C WHERE C.COMD_CD = R.RGB_CD) AS RGB_CD
		        ,R.REC_PER
		        ,R.REC_RSN
		        ,R.REC_DT
		        ,(SELECT C.COMD_NM FROM COMMON_DETAIL C WHERE C.COMD_CD = R.REC_YN) AS REC_YN
		FROM STUDENT S, DEPARTMENT D, RECORD R
		WHERE S.DEP_CD = D.DEP_CD
		AND S.STU_NO = R.STU_NO
		AND S.STU_NO = #{stuNo}
	</select>
	
	<update id="yesOrNo" parameterType="map"> 
		UPDATE RECORD R
		SET R.REC_YN = #{Yn}
		WHERE R.STU_NO = #{stuNo}
	</update>

</mapper>







